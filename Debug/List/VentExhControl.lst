###############################################################################
#
# IAR ANSI C/C++ Compiler V7.40.3.8902/W32 for ARM        16/Oct/2016  13:51:40
# Copyright 1999-2015 IAR Systems AB.
#
#    Cpu mode     =  thumb
#    Endian       =  little
#    Source file  =  
#        E:\Ventilator\SoftWare\SVC_Software\Rev_SVC_FINAL_SOFTware\SVC-C-Rev15
#        Alg 3-1.2-1.2 - 0724_AutoZero - Copy\modules\Source\VentExhControl.c
#    Command line =  
#        "E:\Ventilator\SoftWare\SVC_Software\Rev_SVC_FINAL_SOFTware\SVC-C-Rev15
#        Alg 3-1.2-1.2 - 0724_AutoZero - Copy\modules\Source\VentExhControl.c"
#        -D USE_STDPERIPH_DRIVER -D STM32F40XX -lC
#        "E:\Ventilator\SoftWare\SVC_Software\Rev_SVC_FINAL_SOFTware\SVC-C-Rev15
#        Alg 3-1.2-1.2 - 0724_AutoZero - Copy\Debug\List\" -o
#        "E:\Ventilator\SoftWare\SVC_Software\Rev_SVC_FINAL_SOFTware\SVC-C-Rev15
#        Alg 3-1.2-1.2 - 0724_AutoZero - Copy\Debug\Obj\" --no_cse --no_unroll
#        --no_inline --no_code_motion --no_tbaa --no_clustering --no_scheduling
#        --debug --endian=little --cpu=Cortex-M4 -e --fpu=VFPv4_sp
#        --dlib_config "C:\Program Files (x86)\IAR Systems\Embedded Workbench
#        7.2_2\arm\INC\c\DLib_Config_Normal.h" -I
#        "E:\Ventilator\SoftWare\SVC_Software\Rev_SVC_FINAL_SOFTware\SVC-C-Rev15
#        Alg 3-1.2-1.2 - 0724_AutoZero - Copy\board\" -I
#        "E:\Ventilator\SoftWare\SVC_Software\Rev_SVC_FINAL_SOFTware\SVC-C-Rev15
#        Alg 3-1.2-1.2 - 0724_AutoZero - Copy\app\" -I
#        "E:\Ventilator\SoftWare\SVC_Software\Rev_SVC_FINAL_SOFTware\SVC-C-Rev15
#        Alg 3-1.2-1.2 - 0724_AutoZero -
#        Copy\Libraries\CMSIS\Device\ST\STM32F4xx\Include\" -I
#        "E:\Ventilator\SoftWare\SVC_Software\Rev_SVC_FINAL_SOFTware\SVC-C-Rev15
#        Alg 3-1.2-1.2 - 0724_AutoZero -
#        Copy\Libraries\STM32F4xx_StdPeriph_Driver\inc\" -I
#        "E:\Ventilator\SoftWare\SVC_Software\Rev_SVC_FINAL_SOFTware\SVC-C-Rev15
#        Alg 3-1.2-1.2 - 0724_AutoZero - Copy\modules\Header\" -On
#        --use_c++_inline -I "C:\Program Files (x86)\IAR Systems\Embedded
#        Workbench 7.2_2\arm\CMSIS\Include\" --relaxed_fp
#    List file    =  
#        E:\Ventilator\SoftWare\SVC_Software\Rev_SVC_FINAL_SOFTware\SVC-C-Rev15
#        Alg 3-1.2-1.2 - 0724_AutoZero - Copy\Debug\List\VentExhControl.lst
#    Object file  =  
#        E:\Ventilator\SoftWare\SVC_Software\Rev_SVC_FINAL_SOFTware\SVC-C-Rev15
#        Alg 3-1.2-1.2 - 0724_AutoZero - Copy\Debug\Obj\VentExhControl.o
#
###############################################################################

E:\Ventilator\SoftWare\SVC_Software\Rev_SVC_FINAL_SOFTware\SVC-C-Rev15 Alg 3-1.2-1.2 - 0724_AutoZero - Copy\modules\Source\VentExhControl.c
      1          //------------------------------------------------------------------------------
      2          // SAADAT Co 
      3          // VENTILATOR Project 
      4          // Control System Algorithm
      5          // DEVELOPER : Mohsen Saffar
      6          // VER : 1.2
      7          // Revision Date: 9/6/2016
      8          //------------------------------------------------------------------------------
      9          
     10          // version 1.2 includes : the EXH control algorithm with set of PWM target, Anti wind up, 2 phase controller and open and close commands, sound reduce madule. 
     11          
     12          //Amendment 1.1 ---> 1.2: 1. Remove and reduce the sound of Exh valve in closing and opening moments 
     13          
     14          
     15          
     16          
     17          #include  "../Header/VentAlg.h"
     18          #include  "../Header/VentExhControl.h"
     19          #include <math.h>
     20          
     21          extern struct StructInitCalib InitCalib;
     22          extern UNION_PACKET_SECOND_SERIAL  COM2;
     23          

   \                                 In section .text, align 4, keep-with-next
     24          Uint  newExhValveController(Float target,Float PressureINHMeasure,Float FlowEXHMeasure,Float BiasFlow, Uchar IsFlagInitExhal)
     25          {
   \                     newExhValveController: (+1)
   \   00000000   0xB570             PUSH     {R4-R6,LR}
   \   00000002   0xED2D 0x8B06      VPUSH    {D8-D10}
   \   00000006   0xEEB0 0x8A40      VMOV.F32 S16,S0
   \   0000000A   0xEEF0 0x8A60      VMOV.F32 S17,S1
   \   0000000E   0xEEB0 0x9A41      VMOV.F32 S18,S2
   \   00000012   0xEEF0 0x9A61      VMOV.F32 S19,S3
   \   00000016   0x0006             MOVS     R6,R0
     26            
     27            // defining the variables and constants
     28          
     29            static Float Pressure_Error;
     30            static Float Saturated_EXH_PWM;
     31            static Float targetpwm;
     32            static Float I_term;
     33            Float  P_term;
     34            static Uword stableflag;
     35            static Uword Recovering_Pressure_timer=0;
     36            static Float Final_EXH_PWM=1700;
     37            static Float antiwindup=0;
     38            static int ExhDeadzone;
     39            // Calibration result 
     40           
     41          //  InitCalib.PWM[0]=1886;
     42          //  InitCalib.PWM[1]=1936;
     43          //  InitCalib.PWM[2]=1969;
     44          //  InitCalib.PWM[3]=2001;
     45          //  InitCalib.PWM[4]=2034;
     46          //  InitCalib.PWM[5]=2066;
     47          //  InitCalib.PWM[6]=2097;
     48          //  InitCalib.PWM[7]=2128;
     49          //  InitCalib.PWM[8]=2160;
     50          //  InitCalib.PWM[9]=2195;
     51          //  InitCalib.PWM[10]=2228;
     52          //  InitCalib.PWM[11]=2261;
     53          //  InitCalib.PWM[12]=2293;
     54          //  InitCalib.PWM[13]=2324;
     55          //  InitCalib.PWM[14]=2357;
     56          //  InitCalib.PWM[15]=2390;
     57          //  InitCalib.PWM[16]=2424;
     58          //  InitCalib.PWM[17]=2456;
     59          //  InitCalib.PWM[18]=2489;
     60          //  InitCalib.PWM[19]=2510;
     61          //  InitCalib.PWM[20]=2554;
     62          //  InitCalib.PWM[21]=2587;
     63          //  InitCalib.PWM[22]=2620;
     64          //  InitCalib.PWM[23]=2653;
     65          //  InitCalib.PWM[24]=2684;
     66          //  InitCalib.PWM[25]=2715;
     67          //  InitCalib.PWM[26]=2746;
     68          //  InitCalib.PWM[27]=2776;
     69          //  InitCalib.PWM[28]=2807;
     70          //  InitCalib.PWM[29]=2837;
     71          //  InitCalib.PWM[30]=2870;
     72          //  InitCalib.PWM[31]=2901;
     73          //  InitCalib.PWM[32]=2936;
     74          //  InitCalib.PWM[33]=2965;
     75          //  InitCalib.PWM[34]=2995;
     76          //  InitCalib.PWM[35]=3026;
     77          //  InitCalib.PWM[36]=3057;
     78          //  InitCalib.PWM[37]=3088;
     79          //  InitCalib.PWM[38]=3118;
     80          //  InitCalib.PWM[39]=3150;
     81          // 
     82          //  #define PWM_Filter_Coefficent                      0.9
     83          //#define Upper_PWM_EXH_Deadzone                     8000
     84              if (target>0)
   \   00000018   0xEEB5 0x8A40      VCMP.F32 S16,#0.0
   \   0000001C   0xEEF1 0xFA10      FMSTAT   
   \   00000020   0xDD15             BLE.N    ??newExhValveController_0
     85            {
     86              targetpwm = InitCalib.PWM[(Uint)target-1];
   \   00000022   0xEEBD 0x0AC8      VCVT.S32.F32 S0,S16
   \   00000026   0xEE10 0x0A10      VMOV     R0,S0
   \   0000002A   0xB280             UXTH     R0,R0            ;; ZeroExt  R0,R0,#+16,#+16
   \   0000002C   0x49A5             LDR.N    R1,??newExhValveController_1+0x28
   \   0000002E   0xEB11 0x0040      ADDS     R0,R1,R0, LSL #+1
   \   00000032   0xF8B0 0x01E2      LDRH     R0,[R0, #+482]
   \   00000036   0xEE00 0x0A10      VMOV     S0,R0
   \   0000003A   0xEEB8 0x0A40      VCVT.F32.U32 S0,S0
   \   0000003E   0x48A2             LDR.N    R0,??newExhValveController_1+0x2C
   \   00000040   0xED80 0x0A00      VSTR     S0,[R0, #0]
     87              ExhDeadzone = InitCalib.ExhDeadZone;
   \   00000044   0x489F             LDR.N    R0,??newExhValveController_1+0x28
   \   00000046   0xF8B0 0x0234      LDRH     R0,[R0, #+564]
   \   0000004A   0x49A0             LDR.N    R1,??newExhValveController_1+0x30
   \   0000004C   0x6008             STR      R0,[R1, #+0]
     88            }
     89            if (target==CLOSEVALVE)
   \                     ??newExhValveController_0: (+1)
   \   0000004E   0xED9F 0x0A93      VLDR.W   S0,??newExhValveController_1  ;; 0x447a0000
   \   00000052   0xEEB4 0x8A40      VCMP.F32 S16,S0
   \   00000056   0xEEF1 0xFA10      FMSTAT   
   \   0000005A   0xD111             BNE.N    ??newExhValveController_2
     90            {
     91             // Final_EXH_PWM = 9500;
     92              Final_EXH_PWM=PWM_Filter_Coefficent*Final_EXH_PWM+(1-PWM_Filter_Coefficent)*Upper_PWM_EXH_Deadzone;
   \   0000005C   0x489C             LDR.N    R0,??newExhValveController_1+0x34
   \   0000005E   0x6800             LDR      R0,[R0, #+0]
   \   00000060   0x.... 0x....      BL       __aeabi_f2d
   \   00000064   0x4A9B             LDR.N    R2,??newExhValveController_1+0x38  ;; 0xcccccccd
   \   00000066   0x4B9C             LDR.N    R3,??newExhValveController_1+0x3C  ;; 0x3feccccc
   \   00000068   0x.... 0x....      BL       __aeabi_dmul
   \   0000006C   0xF07F 0x0201      MVNS     R2,#+1
   \   00000070   0x4B9A             LDR.N    R3,??newExhValveController_1+0x40  ;; 0x4088ffff
   \   00000072   0x.... 0x....      BL       __aeabi_dadd
   \   00000076   0x.... 0x....      BL       __aeabi_d2f
   \   0000007A   0x4995             LDR.N    R1,??newExhValveController_1+0x34
   \   0000007C   0x6008             STR      R0,[R1, #+0]
   \   0000007E   0xE102             B.N      ??newExhValveController_3
     93            }
     94            else if ((target==OPENVALVE)||(target==0))
   \                     ??newExhValveController_2: (+1)
   \   00000080   0xED9F 0x0A87      VLDR.W   S0,??newExhValveController_1+0x4  ;; 0x44fa0000
   \   00000084   0xEEB4 0x8A40      VCMP.F32 S16,S0
   \   00000088   0xEEF1 0xFA10      FMSTAT   
   \   0000008C   0xD004             BEQ.N    ??newExhValveController_4
   \   0000008E   0xEEB5 0x8A40      VCMP.F32 S16,#0.0
   \   00000092   0xEEF1 0xFA10      FMSTAT   
   \   00000096   0xD10A             BNE.N    ??newExhValveController_5
     95            {
     96              Final_EXH_PWM=ExhDeadzone - 200;
   \                     ??newExhValveController_4: (+1)
   \   00000098   0x488C             LDR.N    R0,??newExhValveController_1+0x30
   \   0000009A   0x6800             LDR      R0,[R0, #+0]
   \   0000009C   0x38C8             SUBS     R0,R0,#+200
   \   0000009E   0xEE00 0x0A10      VMOV     S0,R0
   \   000000A2   0xEEB8 0x0AC0      VCVT.F32.S32 S0,S0
   \   000000A6   0x488A             LDR.N    R0,??newExhValveController_1+0x34
   \   000000A8   0xED80 0x0A00      VSTR     S0,[R0, #0]
   \   000000AC   0xE0EB             B.N      ??newExhValveController_3
     97              //Final_EXH_PWM = 0;
     98            }
     99            else
    100            {
    101            
    102            
    103            
    104          
    105            
    106            // initialization
    107            
    108            if (IsFlagInitExhal == True)
   \                     ??newExhValveController_5: (+1)
   \   000000AE   0xB2F6             UXTB     R6,R6            ;; ZeroExt  R6,R6,#+24,#+24
   \   000000B0   0x2E01             CMP      R6,#+1
   \   000000B2   0xD10E             BNE.N    ??newExhValveController_6
    109            {
    110              Final_EXH_PWM = 1700;
   \   000000B4   0x4886             LDR.N    R0,??newExhValveController_1+0x34
   \   000000B6   0x498A             LDR.N    R1,??newExhValveController_1+0x44  ;; 0x44d48000
   \   000000B8   0x6001             STR      R1,[R0, #+0]
    111              I_term = 0;
   \   000000BA   0x488A             LDR.N    R0,??newExhValveController_1+0x48
   \   000000BC   0x2100             MOVS     R1,#+0
   \   000000BE   0x6001             STR      R1,[R0, #+0]
    112              antiwindup = 0;
   \   000000C0   0x4889             LDR.N    R0,??newExhValveController_1+0x4C
   \   000000C2   0x2100             MOVS     R1,#+0
   \   000000C4   0x6001             STR      R1,[R0, #+0]
    113              stableflag=0;
   \   000000C6   0x2000             MOVS     R0,#+0
   \   000000C8   0x4988             LDR.N    R1,??newExhValveController_1+0x50
   \   000000CA   0x6008             STR      R0,[R1, #+0]
    114              Recovering_Pressure_timer=0;
   \   000000CC   0x2000             MOVS     R0,#+0
   \   000000CE   0x4988             LDR.N    R1,??newExhValveController_1+0x54
   \   000000D0   0x6008             STR      R0,[R1, #+0]
    115            }
    116            
    117            
    118            Pressure_Error = target - PressureINHMeasure;
   \                     ??newExhValveController_6: (+1)
   \   000000D2   0xEE38 0x0A68      VSUB.F32 S0,S16,S17
   \   000000D6   0x4887             LDR.N    R0,??newExhValveController_1+0x58
   \   000000D8   0xED80 0x0A00      VSTR     S0,[R0, #0]
    119            //final pwm set to be opened according to the PEEP value
    120            
    121            if ( (Pressure_Error <-Error_Limit_Changing_phase) && (stableflag==0) )
   \   000000DC   0x4885             LDR.N    R0,??newExhValveController_1+0x58
   \   000000DE   0xED90 0x0A00      VLDR     S0,[R0, #0]
   \   000000E2   0xEEFA 0x0A04      VMOV.F32 S1,#-10.0
   \   000000E6   0xEEB4 0x0A60      VCMP.F32 S0,S1
   \   000000EA   0xEEF1 0xFA10      FMSTAT   
   \   000000EE   0xD50D             BPL.N    ??newExhValveController_7
   \   000000F0   0x487E             LDR.N    R0,??newExhValveController_1+0x50
   \   000000F2   0x6800             LDR      R0,[R0, #+0]
   \   000000F4   0x2800             CMP      R0,#+0
   \   000000F6   0xD109             BNE.N    ??newExhValveController_7
    122            {
    123              Final_EXH_PWM = targetpwm-Lower_PWM_EXH_Start;
   \   000000F8   0x4873             LDR.N    R0,??newExhValveController_1+0x2C
   \   000000FA   0xED90 0x0A00      VLDR     S0,[R0, #0]
   \   000000FE   0xEDDF 0x0A69      VLDR.W   S1,??newExhValveController_1+0x8  ;; 0xc4160000
   \   00000102   0xEE30 0x0A20      VADD.F32 S0,S0,S1
   \   00000106   0x4872             LDR.N    R0,??newExhValveController_1+0x34
   \   00000108   0xED80 0x0A00      VSTR     S0,[R0, #0]
    124              
    125            }
    126            
    127              //final pwm set to be closed according to the PEEP value
    128            if ( (Pressure_Error >-Error_Limit_Changing_phase) && (stableflag==0)) 
   \                     ??newExhValveController_7: (+1)
   \   0000010C   0x4879             LDR.N    R0,??newExhValveController_1+0x58
   \   0000010E   0xED90 0x0A00      VLDR     S0,[R0, #0]
   \   00000112   0xEDDF 0x0A65      VLDR.W   S1,??newExhValveController_1+0xC  ;; 0xc11fffff
   \   00000116   0xEEB4 0x0A60      VCMP.F32 S0,S1
   \   0000011A   0xEEF1 0xFA10      FMSTAT   
   \   0000011E   0xDB13             BLT.N    ??newExhValveController_8
   \   00000120   0x4872             LDR.N    R0,??newExhValveController_1+0x50
   \   00000122   0x6800             LDR      R0,[R0, #+0]
   \   00000124   0x2800             CMP      R0,#+0
   \   00000126   0xD10F             BNE.N    ??newExhValveController_8
    129            {
    130              Final_EXH_PWM = targetpwm-Lower_PWM_EXH_Start;
   \   00000128   0x4867             LDR.N    R0,??newExhValveController_1+0x2C
   \   0000012A   0xED90 0x0A00      VLDR     S0,[R0, #0]
   \   0000012E   0xEDDF 0x0A5D      VLDR.W   S1,??newExhValveController_1+0x8  ;; 0xc4160000
   \   00000132   0xEE30 0x0A20      VADD.F32 S0,S0,S1
   \   00000136   0x4866             LDR.N    R0,??newExhValveController_1+0x34
   \   00000138   0xED80 0x0A00      VSTR     S0,[R0, #0]
    131              stableflag=1;
   \   0000013C   0x2001             MOVS     R0,#+1
   \   0000013E   0x496B             LDR.N    R1,??newExhValveController_1+0x50
   \   00000140   0x6008             STR      R0,[R1, #+0]
    132              Recovering_Pressure_timer=0;
   \   00000142   0x2000             MOVS     R0,#+0
   \   00000144   0x496A             LDR.N    R1,??newExhValveController_1+0x54
   \   00000146   0x6008             STR      R0,[R1, #+0]
    133            }
    134            
    135            // check whether if it is the first period of controlling phase or not
    136            if (stableflag==1)
   \                     ??newExhValveController_8: (+1)
   \   00000148   0x4868             LDR.N    R0,??newExhValveController_1+0x50
   \   0000014A   0x6800             LDR      R0,[R0, #+0]
   \   0000014C   0x2801             CMP      R0,#+1
   \   0000014E   0xF040 0x809A      BNE.W    ??newExhValveController_3
    137            {
    138              if (Recovering_Pressure_timer < Recovering_Pressure_Time)
   \   00000152   0x4867             LDR.N    R0,??newExhValveController_1+0x54
   \   00000154   0x6800             LDR      R0,[R0, #+0]
   \   00000156   0x280A             CMP      R0,#+10
   \   00000158   0xD20F             BCS.N    ??newExhValveController_9
    139              {
    140                Recovering_Pressure_timer=Recovering_Pressure_timer+1;
   \   0000015A   0x4865             LDR.N    R0,??newExhValveController_1+0x54
   \   0000015C   0x6800             LDR      R0,[R0, #+0]
   \   0000015E   0x1C40             ADDS     R0,R0,#+1
   \   00000160   0x4963             LDR.N    R1,??newExhValveController_1+0x54
   \   00000162   0x6008             STR      R0,[R1, #+0]
    141                Final_EXH_PWM = targetpwm + Upper_PWM_EXH_start;
   \   00000164   0x4858             LDR.N    R0,??newExhValveController_1+0x2C
   \   00000166   0xED90 0x0A00      VLDR     S0,[R0, #0]
   \   0000016A   0xEDDF 0x0A50      VLDR.W   S1,??newExhValveController_1+0x10  ;; 0x44160000
   \   0000016E   0xEE30 0x0A20      VADD.F32 S0,S0,S1
   \   00000172   0x4857             LDR.N    R0,??newExhValveController_1+0x34
   \   00000174   0xED80 0x0A00      VSTR     S0,[R0, #0]
   \   00000178   0xE076             B.N      ??newExhValveController_10
    142              }
    143              else
    144              {
    145                // applying the modified PI controller
    146                P_term = Kp*Pressure_Error;
   \                     ??newExhValveController_9: (+1)
   \   0000017A   0x485E             LDR.N    R0,??newExhValveController_1+0x58
   \   0000017C   0xED90 0x0A00      VLDR     S0,[R0, #0]
   \   00000180   0xEDDF 0x0A4B      VLDR.W   S1,??newExhValveController_1+0x14  ;; 0x435c0000
   \   00000184   0xEE20 0x0A20      VMUL.F32 S0,S0,S1
   \   00000188   0xEEB0 0xAA40      VMOV.F32 S20,S0
    147                I_term = (Ki*Pressure_Error + antiwindup)*Ts+I_term;
   \   0000018C   0x4859             LDR.N    R0,??newExhValveController_1+0x58
   \   0000018E   0xED90 0x0A00      VLDR     S0,[R0, #0]
   \   00000192   0xEDDF 0x0A48      VLDR.W   S1,??newExhValveController_1+0x18  ;; 0x43af0000
   \   00000196   0x4854             LDR.N    R0,??newExhValveController_1+0x4C
   \   00000198   0xED90 0x1A00      VLDR     S2,[R0, #0]
   \   0000019C   0xEE00 0x1A20      VMLA.F32 S2,S0,S1
   \   000001A0   0xEE11 0x0A10      VMOV     R0,S2
   \   000001A4   0x.... 0x....      BL       __aeabi_f2d
   \   000001A8   0x4A53             LDR.N    R2,??newExhValveController_1+0x5C  ;; 0x47ae147b
   \   000001AA   0x4B54             LDR.N    R3,??newExhValveController_1+0x60  ;; 0x3f647ae1
   \   000001AC   0x.... 0x....      BL       __aeabi_dmul
   \   000001B0   0x0004             MOVS     R4,R0
   \   000001B2   0x000D             MOVS     R5,R1
   \   000001B4   0x484B             LDR.N    R0,??newExhValveController_1+0x48
   \   000001B6   0x6800             LDR      R0,[R0, #+0]
   \   000001B8   0x.... 0x....      BL       __aeabi_f2d
   \   000001BC   0x0022             MOVS     R2,R4
   \   000001BE   0x002B             MOVS     R3,R5
   \   000001C0   0x.... 0x....      BL       __aeabi_dadd
   \   000001C4   0x.... 0x....      BL       __aeabi_d2f
   \   000001C8   0x4946             LDR.N    R1,??newExhValveController_1+0x48
   \   000001CA   0x6008             STR      R0,[R1, #+0]
    148                Final_EXH_PWM = (Uword) (P_term + I_term);
   \   000001CC   0x4845             LDR.N    R0,??newExhValveController_1+0x48
   \   000001CE   0xED90 0x0A00      VLDR     S0,[R0, #0]
   \   000001D2   0xEE3A 0x0A00      VADD.F32 S0,S20,S0
   \   000001D6   0xEEBC 0x0AC0      VCVT.U32.F32 S0,S0
   \   000001DA   0xEEB8 0x0A40      VCVT.F32.U32 S0,S0
   \   000001DE   0x483C             LDR.N    R0,??newExhValveController_1+0x34
   \   000001E0   0xED80 0x0A00      VSTR     S0,[R0, #0]
    149                
    150                Saturated_EXH_PWM = Final_EXH_PWM;
   \   000001E4   0x4846             LDR.N    R0,??newExhValveController_1+0x64
   \   000001E6   0x493A             LDR.N    R1,??newExhValveController_1+0x34
   \   000001E8   0x6809             LDR      R1,[R1, #+0]
   \   000001EA   0x6001             STR      R1,[R0, #+0]
    151                
    152                // checking if the Final PWM is saturated
    153                
    154                if (Final_EXH_PWM < targetpwm-Lower_PWM_Deadzone )
   \   000001EC   0x4836             LDR.N    R0,??newExhValveController_1+0x2C
   \   000001EE   0xED90 0x0A00      VLDR     S0,[R0, #0]
   \   000001F2   0xEDDF 0x0A31      VLDR.W   S1,??newExhValveController_1+0x1C  ;; 0xc3960000
   \   000001F6   0xEE30 0x0A20      VADD.F32 S0,S0,S1
   \   000001FA   0x4835             LDR.N    R0,??newExhValveController_1+0x34
   \   000001FC   0xEDD0 0x0A00      VLDR     S1,[R0, #0]
   \   00000200   0xEEF4 0x0A40      VCMP.F32 S1,S0
   \   00000204   0xEEF1 0xFA10      FMSTAT   
   \   00000208   0xD50F             BPL.N    ??newExhValveController_11
    155                {
    156                  Final_EXH_PWM = (Uword)targetpwm-Lower_PWM_Deadzone;
   \   0000020A   0x482F             LDR.N    R0,??newExhValveController_1+0x2C
   \   0000020C   0xED90 0x0A00      VLDR     S0,[R0, #0]
   \   00000210   0xEEBC 0x0AC0      VCVT.U32.F32 S0,S0
   \   00000214   0xEE10 0x0A10      VMOV     R0,S0
   \   00000218   0xF5B0 0x7096      SUBS     R0,R0,#+300
   \   0000021C   0xEE00 0x0A10      VMOV     S0,R0
   \   00000220   0xEEB8 0x0A40      VCVT.F32.U32 S0,S0
   \   00000224   0x482A             LDR.N    R0,??newExhValveController_1+0x34
   \   00000226   0xED80 0x0A00      VSTR     S0,[R0, #0]
    157                }
    158                
    159                
    160                if(Final_EXH_PWM > targetpwm + Upper_PWM_Deadzone )
   \                     ??newExhValveController_11: (+1)
   \   0000022A   0x4827             LDR.N    R0,??newExhValveController_1+0x2C
   \   0000022C   0xED90 0x0A00      VLDR     S0,[R0, #0]
   \   00000230   0xEDDF 0x0A22      VLDR.W   S1,??newExhValveController_1+0x20  ;; 0x43fa0000
   \   00000234   0xEE30 0x0A20      VADD.F32 S0,S0,S1
   \   00000238   0x4825             LDR.N    R0,??newExhValveController_1+0x34
   \   0000023A   0xEDD0 0x0A00      VLDR     S1,[R0, #0]
   \   0000023E   0xEEB4 0x0A60      VCMP.F32 S0,S1
   \   00000242   0xEEF1 0xFA10      FMSTAT   
   \   00000246   0xD50F             BPL.N    ??newExhValveController_10
    161                {
    162                  Final_EXH_PWM = (Uword)targetpwm + Upper_PWM_Deadzone ;
   \   00000248   0x481F             LDR.N    R0,??newExhValveController_1+0x2C
   \   0000024A   0xED90 0x0A00      VLDR     S0,[R0, #0]
   \   0000024E   0xEEBC 0x0AC0      VCVT.U32.F32 S0,S0
   \   00000252   0xEE10 0x0A10      VMOV     R0,S0
   \   00000256   0xF510 0x70FA      ADDS     R0,R0,#+500
   \   0000025A   0xEE00 0x0A10      VMOV     S0,R0
   \   0000025E   0xEEB8 0x0A40      VCVT.F32.U32 S0,S0
   \   00000262   0x481B             LDR.N    R0,??newExhValveController_1+0x34
   \   00000264   0xED80 0x0A00      VSTR     S0,[R0, #0]
    163                }
    164              }
    165              // applying the antiwind up effect
    166              antiwindup = Antiwindup_co*(Ki/(float)Kp)*(Final_EXH_PWM - Saturated_EXH_PWM);
   \                     ??newExhValveController_10: (+1)
   \   00000268   0x4819             LDR.N    R0,??newExhValveController_1+0x34
   \   0000026A   0xED90 0x0A00      VLDR     S0,[R0, #0]
   \   0000026E   0x4824             LDR.N    R0,??newExhValveController_1+0x64
   \   00000270   0xEDD0 0x0A00      VLDR     S1,[R0, #0]
   \   00000274   0xEE30 0x0A60      VSUB.F32 S0,S0,S1
   \   00000278   0xEDDF 0x0A11      VLDR.W   S1,??newExhValveController_1+0x24  ;; 0x42deba2f
   \   0000027C   0xEE20 0x0A20      VMUL.F32 S0,S0,S1
   \   00000280   0x4819             LDR.N    R0,??newExhValveController_1+0x4C
   \   00000282   0xED80 0x0A00      VSTR     S0,[R0, #0]
    167            }
    168          }
    169            // PWM calculation related to the completely close and open situation
    170            
    171            
    172          //  COM2.Data.P14 = (u16) (Final_EXH_PWM);
    173           // COM2->P15 = (u16) (R_Lung*1e3);
    174            return (u16)(Final_EXH_PWM);
   \                     ??newExhValveController_3: (+1)
   \   00000286   0x4812             LDR.N    R0,??newExhValveController_1+0x34
   \   00000288   0xED90 0x0A00      VLDR     S0,[R0, #0]
   \   0000028C   0xEEBD 0x0AC0      VCVT.S32.F32 S0,S0
   \   00000290   0xEE10 0x0A10      VMOV     R0,S0
   \   00000294   0xB280             UXTH     R0,R0            ;; ZeroExt  R0,R0,#+16,#+16
   \   00000296   0xECBD 0x8B06      VPOP     {D8-D10}
   \   0000029A   0xBD70             POP      {R4-R6,PC}       ;; return
   \                     ??newExhValveController_1:
   \   0000029C   0x447A0000         DC32     0x447a0000
   \   000002A0   0x44FA0000         DC32     0x44fa0000
   \   000002A4   0xC4160000         DC32     0xc4160000
   \   000002A8   0xC11FFFFF         DC32     0xc11fffff
   \   000002AC   0x44160000         DC32     0x44160000
   \   000002B0   0x435C0000         DC32     0x435c0000
   \   000002B4   0x43AF0000         DC32     0x43af0000
   \   000002B8   0xC3960000         DC32     0xc3960000
   \   000002BC   0x43FA0000         DC32     0x43fa0000
   \   000002C0   0x42DEBA2F         DC32     0x42deba2f
   \   000002C4   0x........         DC32     InitCalib
   \   000002C8   0x........         DC32     ??targetpwm
   \   000002CC   0x........         DC32     ??ExhDeadzone
   \   000002D0   0x........         DC32     ??Final_EXH_PWM
   \   000002D4   0xCCCCCCCD         DC32     0xcccccccd
   \   000002D8   0x3FECCCCC         DC32     0x3feccccc
   \   000002DC   0x4088FFFF         DC32     0x4088ffff
   \   000002E0   0x44D48000         DC32     0x44d48000
   \   000002E4   0x........         DC32     ??I_term
   \   000002E8   0x........         DC32     ??antiwindup
   \   000002EC   0x........         DC32     ??stableflag
   \   000002F0   0x........         DC32     ??Recovering_Pressure_timer
   \   000002F4   0x........         DC32     ??Pressure_Error
   \   000002F8   0x47AE147B         DC32     0x47ae147b
   \   000002FC   0x3F647AE1         DC32     0x3f647ae1
   \   00000300   0x........         DC32     ??Saturated_EXH_PWM
    175            
    176          }

   \                                 In section .bss, align 4
   \                     ??Pressure_Error:
   \   00000000                      DS8 4

   \                                 In section .bss, align 4
   \                     ??Saturated_EXH_PWM:
   \   00000000                      DS8 4

   \                                 In section .bss, align 4
   \                     ??targetpwm:
   \   00000000                      DS8 4

   \                                 In section .bss, align 4
   \                     ??I_term:
   \   00000000                      DS8 4

   \                                 In section .bss, align 4
   \                     ??stableflag:
   \   00000000                      DS8 4

   \                                 In section .bss, align 4
   \                     ??Recovering_Pressure_timer:
   \   00000000                      DS8 4

   \                                 In section .data, align 4
   \                     ??Final_EXH_PWM:
   \   00000000   0x44D48000         DC32 44D48000H

   \                                 In section .bss, align 4
   \                     ??antiwindup:
   \   00000000                      DS8 4

   \                                 In section .bss, align 4
   \                     ??ExhDeadzone:
   \   00000000                      DS8 4

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
      40   newExhValveController
        40   -> __aeabi_d2f
        40   -> __aeabi_dadd
        40   -> __aeabi_dmul
        40   -> __aeabi_f2d


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ExhDeadzone
       4  Final_EXH_PWM
       4  I_term
       4  Pressure_Error
       4  Recovering_Pressure_timer
       4  Saturated_EXH_PWM
       4  antiwindup
     772  newExhValveController
       4  stableflag
       4  targetpwm

 
  32 bytes in section .bss
   4 bytes in section .data
 772 bytes in section .text
 
 772 bytes of CODE memory
  36 bytes of DATA memory

Errors: none
Warnings: none
